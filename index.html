<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Maîtriser l'Usinage CNC : Calculs Essentiels pour une Fraise</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {
    box-sizing: border-box;
}
body {
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    margin: 0;
    height: 100vh;
    background-color: #f0f0f0;
}
header {
    width: 100%;
    background-color: #4E4E4E;
    color: #fff;
    padding: 5px;
    text-align: center;
}
nav {
    display: flex;
    justify-content: center;
    background-color: #333;
}
nav a {
    color: white;
    padding: 14px 20px;
    text-decoration: none;
    text-align: center;
}
nav a:hover {
    background-color: #ddd;
    color: black;
}
h1 {
    text-align: center;
    color: #D8D8D8;
}
fieldset {
    display: flex;
    flex-direction: column;
    background-color: #F3F3F3;
    border-radius: 6px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    padding: 10px;
    margin-bottom: 20px;
    border-width: 1px;
}
label {
    margin-bottom: 10px;
}
input, select {
    width: 60%;
    padding: 5px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
}
input[type="range"] {
    width: 100%;
    color: -internal-light-dark(rgb(16, 16, 16), rgb(255, 255, 255));
}
button {
    width: 100%;
    padding: 10px 20px;
    background-color: #4E4E4E;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    margin-bottom: 5px;
}
footer {
    padding: 10px;
    text-align: center;
    background: #ddd;
}
#rotationSpeedSlider {
    margin-bottom: 10px;
}
#result {
    text-align: left;
}
#sliderContainer {
    position: relative;
    width: 100%; /* Ajustez la largeur selon vos besoins */
}
#minRotationSpeed, #currentRotationSpeed, #maxRotationSpeed {
    position: absolute;
    bottom: 0;
    font-weight: bold;
}
#minRotationSpeed {
    left: 0;
}
#currentRotationSpeed {
    left: 50%;
    transform: translateX(-50%);
}
#maxRotationSpeed {
    right: 0;
}
.container {
    display: flex;
    font-size: 0.9em;
    background-color: #ffffff;
}
.column {
    flex: 1;  /*permet aux colonnes de prendre une quantité égale d'espace disponible dans le conteneur parent, les étirant pour qu'elles occupent la totalité de l'espace disponible*/
    padding: 18px;  /*espace à l'intérieur de chaque colonne*/
}
/* Séparateur entre les colonnes */
.column:first-child {  /*sélecteur qui cible le premier élément enfant*/
    border-right: 1px solid #DBDBDB;
}
.radio-group {
    display: flex;
    flex-direction: row-reverse;
    align-items: flex-start;
    gap: 10px; /* Espace entre les boutons radio et leurs libellés */
}
/* Espacement supplémentaire entre les boutons radio et les labels */
.radio-group label {
    margin-right: -45px;
}
.text-bold {
    font-weight: bold;
}

@media screen and (max-width: 700px) {
.container, nav {
    flex-direction: column;
}
}
</style>
</head>
<body>
<header>
    <h1>Maîtriser l'Usinage CNC : Calculs Essentiels pour une Fraise</h1>
    <nav> <a href="GuideCalcFraise.html">Guide calcul fraisage</a> <a href="#">À propos</a> <a href="#">Contact</a> </nav>
</header>
<div class="container">
    <div class="column">
        <h1>Caractéristiques de l'outil</h1>
        <form id="toolForm">
            <fieldset>
                <legend class="text-bold">&nbsp;Géométrie&nbsp;</legend>
                <label for="toolMaterial">Fraise au :</label>
                <select id="toolMaterial" name="toolMaterial">
                    <option value="carbide">Carbure (Carbide)</option>
                    <option value="hss">Acier rapide (HSS - High-Speed Steel)</option>
                    <option value="ti coated">HSS revêtu de TiN, TiCN, TiAlN</option>
                    <option value="ceramics">Céramique</option>
                    <option value="3.175">Diamant</option>
                </select>
                <label for="toolDescription">Description de l'outil :</label>
                <input type="text" id="toolDescription" name="toolDescription">
                <label for="toolDiameter"><span class="text-bold">(DC)</span> Diammeter of cut, diamètre de la fraise</label>
                <select id="toolDiameter" name="toolDiameter">
                    <option value="1">1 mm</option>
                    <option value="2">2 mm</option>
                    <option value="2.5">2.5 mm</option>
                    <option value="3">3 mm</option>
                    <option value="3.175">3.175 mm</option>
                    <option value="4">4 mm</option>
                    <option value="5">5 mm</option>
                    <option value="6">6 mm</option>
                    <option value="8">8 mm</option>
                </select>
                <label for="shaftDiameter"><span class="text-bold">(SFDM)</span> Shaft Diameter, diamètre de la queue</label>
                <select id="shaftDiameter" name="shaftDiameter">
                    <option value="1">1 mm</option>
                    <option value="2">2 mm</option>
                    <option value="2.5">2.5 mm</option>
                    <option value="3">3 mm</option>
                    <option value="3.175">3.175 mm</option>
                    <option value="4">4 mm</option>
                    <option value="5">5 mm</option>
                    <option value="6">6 mm</option>
                    <option value="8">8 mm</option>
                </select>
                <label for="numberOfFlutes"><span class="text-bold">(NOF)</span> Number of Flutes, nombre de dents </label>
                <select id="numberOfFlutes" name="numberOfFlutes">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
                <label for="overAllLength"><span class="text-bold">(OAL)</span> Overall Length, Longueur totale</label>
                <input type="number" id="overAllLength" name="overAllLength">
                <label for="lengthBelow"><span class="text-bold">(LB)</span> Length Below, longueur en dessous du porte outil</label>
                <input type="number" id="lengthBelow" name="lengthBelow">
                <label for="shoulderLength">Longueur de l'épaulement</label>
                <input type="number" id="shoulderLength" name="shoulderLength">
                <label for="lengthOfCut"><span class="text-bold">(LCF)</span> Lendth of Cut, longueur de coupe LU :</label>
                <input type="number" id="lengthOfCut" name="lengthOfCut">
                <label for="CSP"><span class="text-bold">(CSP)</span> Center Cutting, coupe au centre, indique si la fraise est capable de couper à partir du centre.</label>
                <div class="radio-group">
                    <input type="radio" id="CSPTrue" name="CSP" value="true">
                    <label for="CSPTrue">Oui</label>
                    <input type="radio" id="CSPFalse" name="CSP" value="false" checked>
                    <label for="CSPFalse">Non</label>
                </div>
                <label for="HAND"><span class="text-bold">(Hand)</span> Hand of Cut,indique si la fraise est orientée de façon à favoriser une coupe à droite ou à gauche.</label>
                <div class="radio-group">
                    <input type="radio" id="HANDFalse" name="HAND" value="false">
                    <label for="HANDFalse">Gauche</label>
                    <input type="radio" id="HANDTrue" name="HAND" value="true" checked>
                    <label for="HANDTrue">Droite</label>
                </div>
            </fieldset>
        </form>
    </div>
    <div class="column">
        <h1>Calcul vitesse de rotation et d'avance</h1>
        <form id="presetsForm">
            <fieldset>
                <legend class="text-bold">&nbsp;Presets&nbsp;</legend>
                <label for="vc"><span class="text-bold">(Vc)</span> Vitesse de coupe (m/min)</label>
                <select id="vc" name="vc">
                    <option value="500">Bois (massif)</option>
                    <option value="250">CTP, bois tendres</option>
                    <option value="350">MDF, Valcromat</option>
                    <option value="250">PMMA, thermoplastiques</option>
                    <option value="300">PVC expansés, Forex, etc</option>
                    <option value="100">Alu 2017A</option>
                    <option value="200">Cuivre, Laiton, etc</option>
                </select>
                <label for="fz"><span class="text-bold">(Fz)</span> Avance par dent (mm/dent): </label>
                <input type="number" id="fz" step="0.001" value="0.004" required>
                <label for="ap"><span class="text-bold">(Ap)</span> Profondeur de coupe (mm): </label>
                <input type="number" id="ap" step="0.1" value="1.5" required>
                <label class="text-bold">Limites machine:</label>
                <label for="maxFeed">Vitesse d’avance max de la machine (mm/min): </label>
                <input type="number" id="maxFeed" value="2500" required>
                <label for="rotationSpeedSlider">Vitesse de rotation max de la machine (tr/min): </label>
                <div id="sliderContainer">
                    <input type="range" id="rotationSpeedSlider" min="5000" max="30000" step="1000" value="25000" oninput="updateRotationSpeed(this.value)">
                    <span id="minRotationSpeed">5000</span><span id="currentRotationSpeed">25000</span><span id="maxRotationSpeed">30000</span> </div>
            </fieldset>
        </form>
        <button type="button" onclick="calculate()">Calculer</button>
        <button id="generateJSON">Générer le fichier .JSON</button>
    </div>
    <div class="column">
        <h1>Résultats</h1>
        <p id="result"></p>
    </div>
</div>
<footer>
    <p>&copy; 2023 edurel. Tous droits réservés.</p>
    <p>Calculs Essentiels pour une Fraise - Version <span id="version"></span></p>
    <div id="date"></div>
</footer>
<script>
    // Ajoute la fonction generateGUID pour créer un GUID aléatoire
function generateGUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0,
            v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}
    const version = "3.0.0"; // Version actuelle du script
document.addEventListener('DOMContentLoaded', function() { // Attend que tout le contenu de la page soit chargé
    // Mise à jour de la version dans le footer
    document.getElementById('version').textContent = version;
    // Ajout de la date dans le footer
    const dateElement = document.getElementById('date');
    const currentDate = new Date();
    const options = { year: 'numeric', month: 'numeric', day: 'numeric' };
    const formattedDate = currentDate.toLocaleDateString('fr-FR', options);
    dateElement.textContent = `${formattedDate}`;
    // Liste des champs à réinitialiser
    const fieldsToReset = ['toolDiameter', 'shaftDiameter', 'numberOfFlutes','toolMaterial'];
    // Pour chaque champ à réinitialiser
    fieldsToReset.forEach(field => {
        // Récupère l'élément de sélection par son identifiant
        const selectElement = document.getElementById(field);
        // Réinitialise la sélection du champ à aucune option choisie
        selectElement.selectedIndex = -1;
    });
});
    // Ajoute un écouteur d'événements sur le clic du bouton "generateJSON"
document.getElementById('generateJSON').addEventListener('click', function() {
    // La fonction sera déclenchée lorsque le bouton sera cliqué
    // et exécutera les actions associées à la génération du fichier JSON.
    // Récupérer les valeurs du formulaire
    const toolDescription = document.getElementById('toolDescription').value;
    const toolMaterial = document.getElementById('toolMaterial').value;
    const toolDiameter = parseFloat(document.getElementById('toolDiameter').value);
    const shaftDiameter = parseFloat(document.getElementById('shaftDiameter').value);
    const numberOfFlutes = parseInt(document.getElementById('numberOfFlutes').value);
    const overAllLength = parseFloat(document.getElementById('overAllLength').value);
    const lengthBelow = parseFloat(document.getElementById('lengthBelow').value);
    const shoulderLength = parseFloat(document.getElementById('shoulderLength').value);
    const lengthOfCut = parseFloat(document.getElementById('lengthOfCut').value);
    const CSP = document.querySelector('input[name="CSP"]:checked').value === 'true';
    const HAND = document.querySelector('input[name="HAND"]:checked').value === 'true';
    const GUID = generateGUID();
    // Créer un objet avec les valeurs du formulaire
 const formData = {
    // Section des détails de l'outil
        "BMC": toolMaterial,
        "description": toolDescription, // Description de l'outil
    "geometry": {
        "CSP": CSP, // coupe au centre (true/false)
        "DC": parseFloat(toolDiameter), // Diamètre de l'outil de coupe
        "HAND": HAND, // Orientation de la coupe (true/false)
        "LB": parseFloat(lengthBelow), // Longueur en dessous du porte outil
        "LCF": parseFloat(lengthOfCut), // Longueur de coupe LU
        "NOF": parseInt(numberOfFlutes), // Nombre de dents
        "OAL": parseFloat(overAllLength), // Longueur totale
        "SFDM": parseFloat(shaftDiameter), // Diamètre de la queue
        "shoulder-length": parseFloat(shoulderLength), // Longueur de l'épaulement
    },
    "guid": generateGUID(), // Génération du GUID pour l'outil
    "post-process": {
        // Détails du post-traitement de l'outil
        "break-control": false, // Contrôle de la pause
        "comment": "", // Commentaire
        "diameter-offset": 1, // Décalage du diamètre
        "length-offset": 1, // Décalage de la longueur
        "live": false, // Mode en direct
        "manual-tool-change": true, // Changement d'outil manuel
        "number": 1, // Numéro
        "turret": 0 // Tourelle
    },
        "product-id": `${numberOfFlutes}F${toolDiameter}mm`,
        "product-link": "",
        "start-values": {
        "presets": [
          {
            "f_n": null,
            "f_z": null,
            "guid": generateGUID(),
            "n": 24000,
            "n_ramp": 24000,
            "name": "Default preset",
            "tool-coolant": "disabled",
            "use-stepdown": "true",
            "use-stepover": false,
            "v_c": null,
            "v_f": 768,
            "v_f_leadIn": 768,
            "v_f_leadOut": 768,
            "v_f_plunge": 768,
            "v_f_ramp": 768,
            "stepdown": 0.32
          }
        ]
      },
     "type": "flat end mill",
      "unit": "millimeters",
      "vendor": ""
};
    const data = [formData]; // Mettre les données dans un objet 'data'
    const jsonData = {
        "data": data,
        "version": 15
    };
    // Convertir l'objet en chaîne JSON
    const toolJSON = JSON.stringify(jsonData, null, 2);
    // Créer un objet Blob avec la chaîne JSON
    const blob = new Blob([toolJSON], { type: 'application/json' });
    // Créer un élément <a> pour le téléchargement du fichier JSON
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'toolData.json';
    link.click();
});
</script> 
<script>
    function updateRotationSpeed(value) {
            // Mettre à jour la valeur courante affichée
            document.getElementById('currentRotationSpeed').innerText = value;
        }
        function calculate() {
            // Récupérer les valeurs du formulaire
            const vc = parseFloat(document.getElementById('vc').value);
            const fz = parseFloat(document.getElementById('fz').value);
            const ap = parseFloat(document.getElementById('ap').value);
            const toolDiameter = parseFloat(document.getElementById('toolDiameter').value);
            const numberOfFlutes = parseInt(document.getElementById('numberOfFlutes').value);
            const maxSpeed = parseInt(document.getElementById('rotationSpeedSlider').max);
            const maxFeed = parseFloat(document.getElementById('maxFeed').value);
            const currentRotationSpeed = parseInt(document.getElementById('currentRotationSpeed').innerText);

            // Calculer la vitesse de rotation
            let n = (1000 * vc) / (Math.PI * toolDiameter);
            
            // Utiliser currentRotationSpeed si n dépasse sa valeur
            n = Math.min(n, currentRotationSpeed);

            // Calculer la vitesse d’avance
            let vf = n * fz * numberOfFlutes;
            vf = Math.min(vf, maxFeed);
            
            // Afficher les résultats avant l'ajustement
    console.log("Résultats avant ajustement :");
    console.log("Vitesse de rotation (n):", n.toFixed(0), "tr/min");
    console.log("Vitesse d’avance (vf):", (n * fz * numberOfFlutes), "mm/min");

            // Calculer le ratio de réduction
            const ratio = maxFeed / (n * fz * numberOfFlutes);
            console.log("Ratio:", ratio.toFixed(2));
            
            // Adapter la vitesse de rotation
            //Si le ratio est inférieur à 1, le bloc if est exécuté et la vitesse de rotation est ajustée. Si le ratio est égal ou supérieur à 1, le bloc if n'est pas exécuté, et la vitesse de rotation reste inchangée
            if (ratio < 1) {
            n = n * ratio;
           }
        // Afficher les résultats finaux
        console.log("Résultats après ajustement :");
        console.log("Vitesse de rotation (n):", n.toFixed(0), "tr/min");
        console.log("Vitesse d’avance (vf):", vf, "mm/min");

        // Afficher les résultats
        const resultTable = `
    <table id="resultTable">
        <tr>
            <td>&nbsp;</td>
            <td>Retenu</td>
        </tr>
        <tr>
            <td>Vitesse de rotation (n)</td>
            <td>${n.toFixed(0)} tr/min</td>
        </tr>
        <tr>
            <td>Vitesse d’avance en X et Y (vf)</td>
            <td>${vf.toFixed(2)} mm/min</td>
        </tr>
        <tr>
            <td>Vitesse d’avance en Z</td>
            <td>${(vf / 2).toFixed(2)} mm/min</td>
        </tr>
        <tr>
            <td>Profondeur de coupe (ap)</td>
            <td>${ap.toFixed(2)} mm</td>
        </tr>
        <tr>
        <td>% de la vitesse max de rotation</td>
        <td>${ratio >= 1 ? '100' : (ratio*100).toFixed(2)}%</td>
        </tr>
    </table>
`;
        document.getElementById('result').innerHTML = resultTable;
                
            const style = `
    #resultTable {
        border-collapse: collapse;
        width: 100%;
        margin-top: 20px;
    }

    #resultTable td, #resultTable th {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }

    #resultTable th {
        background-color: #f2f2f2;
    }
`;

const styleElement = document.createElement('style');
styleElement.innerHTML = style;
document.head.appendChild(styleElement);
        }
</script>
</body>
</html>